{"version":3,"sources":["../../src/models/tag.js"],"names":["sequelize","DataTypes","Tag","define","email","type","STRING","title","color","subject","unique","ENUM","values","is_job_profile_tag","BOOLEAN","defaultValue","to","DATE","from","assign_to_all_emails","template_id","INTEGER","default_id","is_email_send","job_description","allowNull","priority","parent_id","keyword","hooks","beforeCreate","TAG","options","Promise","resolve","reject","findOne","where","then","docs","timestamps","freezeTableName","classMethods","tag","tag_id","app","route","post","save","find","id","details","status","assignTag","data","map","val","key","match","RegExp","Date","date","getTime","sender_mail","push","_id","size","err","assignNewTag","toString","destroyDefault","db","tagId","destroy","$ne","updateMany","default_tag","$set","catch","findTagInfo","findById","response","error","message","assignTagDuringUpdate","req","length","body","mongoId","splice","update","$in","updatedAt","unread","multi","data1","updatePriority","update_priority","callback","update_response","assignTagByKeyword","findAll","tagType","automatic","forEach","keywords","split","keyword_val","keyword_key","undefined","filter","v","i","a","indexOf","removeTagFromEmails","start","end","associate","models","belongsTo","Template","foreignKey"],"mappings":";;;;;;kBAGe,UAASA,SAAT,EAAoBC,SAApB,EAA+B;AAC1C,QAAMC,MAAMF,UAAUG,MAAV,CAAiB,KAAjB,EAAwB;AAChCC,eAAO;AACHC,kBAAMJ,UAAUK;AADb,SADyB;AAIhCC,eAAO;AACHF,kBAAMJ,UAAUK;AADb,SAJyB;AAOhCE,eAAOP,UAAUK,MAPe;AAQhCG,iBAAS;AACLJ,kBAAMJ,UAAUK,MAAV,CAAiB,GAAjB,CADD;AAELI,oBAAQ;AAFH,SARuB;AAYhCL,cAAM;AACFA,kBAAMJ,UAAUU,IADd;AAEFC,oBAAQ,CAAC,SAAD,EAAY,QAAZ,EAAsB,WAAtB;AAFN,SAZ0B;AAgBhCC,4BAAoB;AAChBR,kBAAMJ,UAAUa,OADA;AAEhBC,0BAAc;AAFE,SAhBY;AAoBhCC,YAAIf,UAAUgB,IApBkB;AAqBhCC,cAAMjB,UAAUgB,IArBgB;AAsBhCE,8BAAsB;AAClBd,kBAAMJ,UAAUa,OADE;AAElBC,0BAAc;AAFI,SAtBU;AA0BhCK,qBAAa,EAAEf,MAAMJ,UAAUoB,OAAlB,EA1BmB;AA2BhCC,oBAAY;AACRjB,kBAAMJ,UAAUoB,OADR;AAERN,0BAAc;AAFN,SA3BoB;AA+BhCQ,uBAAe;AACXlB,kBAAMJ,UAAUa,OADL;AAEXC,0BAAc;AAFH,SA/BiB;AAmChCS,yBAAiB;AACbnB,kBAAMJ,UAAUK,MADH;AAEbS,0BAAc,EAFD;AAGbU,uBAAW;AAHE,SAnCe;AAwChCC,kBAAU;AACNrB,kBAAMJ,UAAUK,MADV;AAENS,0BAAc,CAFR;AAGNU,uBAAW;AAHL,SAxCsB;AA6ChCE,mBAAW;AACPtB,kBAAMJ,UAAUoB,OADT;AAEPN,0BAAc,CAFP;AAGPU,uBAAW;AAHJ,SA7CqB;AAkDhCG,iBAAS;AACLvB,kBAAMJ,UAAUK,MADX;AAELS,0BAAc,IAFT;AAGLU,uBAAW;AAHN;AAlDuB,KAAxB,EAuDT;AACCI,eAAO;AACHC,0BAAc,sBAASC,GAAT,EAAcC,OAAd,EAAuB;AAAA;;AACjC,uBAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,wBAAI,CAACJ,IAAIJ,SAAT,EAAoB;AAChB,8BAAKS,OAAL,CAAa,EAAEC,OAAO,EAAE5B,SAASsB,IAAItB,OAAf,EAAT,EAAb,EACK6B,IADL,CACU,UAACC,IAAD,EAAU;AACZ,gCAAIA,IAAJ,EAAU;AACNJ,uCAAO,wBAAP;AACH,6BAFD,MAEO;AACHD,wCAAQ,EAAEK,UAAF,EAAR;AACH;AACJ,yBAPL;AAQH,qBATD,MASO;AACHL;AACH;AACJ,iBAbM,CAAP;AAcH;AAhBE,SADR;AAmBCM,oBAAY,IAnBb;AAoBCC,yBAAiB,IApBlB;AAqBChB,mBAAW,IArBZ;AAsBCiB,sBAAc;AACV;AACAC,eAFU;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,wBAENC,MAFM,EAEE;AAAA;;AACRC,oBAAIC,KAAJ,CAAU,gBAAV,EAA4BC,IAA5B,CAAiCJ,IAAIK,IAArC;AACA,uBAAO,IAAIf,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,2BAAKc,IAAL,CAAU;AACFZ,+BAAO;AACHa,gCAAIN;AADD;AADL,qBAAV,EAKKN,IALL,CAKU,UAACa,OAAD,EAAa;AACf,4BAAIA,OAAJ,EAAa;AACTjB,oCAAQ;AACJkB,wCAAQ;AADJ,6BAAR;AAGH,yBAJD,MAIO;AACHjB,mCAAO,gBAAP;AACH;AACJ,qBAbL;AAcH,iBAfM,CAAP;AAgBH,aApBS;AAqBVkB,qBArBU,qBAqBAV,GArBA,EAqBKvC,KArBL,EAqBY;AAClB,uBAAO,IAAI6B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC/B,0BAAM6C,IAAN,CAAW,EAAX,EACKX,IADL,CACU,UAACgB,IAAD,EAAU;AACZ,4BAAIJ,KAAK,EAAT;AACA,yCAAEK,GAAF,CAAMD,IAAN,EAAY,UAACE,GAAD,EAAMC,GAAN,EAAc;AACtB,gCAAKD,IAAI/C,OAAJ,CAAYiD,KAAZ,CAAkB,IAAIC,MAAJ,CAAWhB,IAAIlC,OAAf,EAAwB,IAAxB,CAAlB,CAAD,IAAwDkC,IAAI3B,EAAJ,IAAU2B,IAAIzB,IAAf,IAAyB,IAAI0C,IAAJ,CAASJ,IAAIK,IAAb,EAAmBC,OAAnB,KAA+B,IAAIF,IAAJ,CAASjB,IAAI3B,EAAb,EAAiB8C,OAAjB,EAA/B,IAA6D,IAAIF,IAAJ,CAASJ,IAAIK,IAAb,EAAmBC,OAAnB,KAA+B,IAAIF,IAAJ,CAASjB,IAAIzB,IAAb,EAAmB4C,OAAnB,EAA5K,IAAgNnB,IAAIvC,KAAL,IAAgBoD,IAAIO,WAAJ,CAAgBL,KAAhB,CAAsB,IAAIC,MAAJ,CAAWhB,IAAIvC,KAAf,EAAsB,IAAtB,CAAtB,CAAnO,EAAyR;AACrR8C,mCAAGc,IAAH,CAAQR,IAAIS,GAAZ;AACA,oCAAIR,OAAQ,iBAAES,IAAF,CAAOZ,IAAP,IAAe,CAA3B,EAA+B;AAC3BpB,4CAAQgB,EAAR;AACH;AACJ,6BALD,MAKO;AACH,oCAAIO,OAAQ,iBAAES,IAAF,CAAOZ,IAAP,IAAe,CAA3B,EAA+B;AAC3BpB,4CAAQgB,EAAR;AACH;AACJ;AAEJ,yBAZD;AAaH,qBAhBL,EAgBO,UAACiB,GAAD,EAAS;AACRhC,+BAAOgC,GAAP;AACH,qBAlBL;AAmBH,iBApBM,CAAP;AAqBH,aA3CS;AA4CVC,wBA5CU,wBA4CGzB,GA5CH,EA4CQvC,KA5CR,EA4Ce;AACrB,uBAAO,IAAI6B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC/B,0BAAM6C,IAAN,CAAW,EAAEL,QAASD,IAAIhB,SAAL,CAAgB0C,QAAhB,EAAV,EAAX,EACK/B,IADL,CACU,UAACgB,IAAD,EAAU;AACZ,4BAAIJ,KAAK,EAAT;AACA,yCAAEK,GAAF,CAAMD,IAAN,EAAY,UAACE,GAAD,EAAMC,GAAN,EAAc;AACtB,gCAAKd,IAAIlC,OAAJ,IAAe+C,IAAI/C,OAAJ,CAAYiD,KAAZ,CAAkB,IAAIC,MAAJ,CAAWhB,IAAIlC,OAAf,EAAwB,IAAxB,CAAlB,CAAhB,IAAuEkC,IAAI3B,EAAJ,IAAU2B,IAAIzB,IAAf,IAAyB,IAAI0C,IAAJ,CAASJ,IAAIK,IAAb,EAAmBC,OAAnB,KAA+B,IAAIF,IAAJ,CAASjB,IAAI3B,EAAb,EAAiB8C,OAAjB,EAA/B,IAA6D,IAAIF,IAAJ,CAASJ,IAAIK,IAAb,EAAmBC,OAAnB,KAA+B,IAAIF,IAAJ,CAASjB,IAAIzB,IAAb,EAAmB4C,OAAnB,EAA3L,IAA+NnB,IAAIvC,KAAL,IAAgBoD,IAAIO,WAAJ,CAAgBL,KAAhB,CAAsB,IAAIC,MAAJ,CAAWhB,IAAIvC,KAAf,EAAsB,IAAtB,CAAtB,CAAlP,EAAwS;AACpS8C,mCAAGc,IAAH,CAAQR,IAAIS,GAAZ;AACA,oCAAIR,OAAQ,iBAAES,IAAF,CAAOZ,IAAP,IAAe,CAA3B,EAA+B;AAC3BpB,4CAAQgB,EAAR;AACH;AACJ,6BALD,MAKO;AACH,oCAAIO,OAAQ,iBAAES,IAAF,CAAOZ,IAAP,IAAe,CAA3B,EAA+B;AAC3BpB,4CAAQgB,EAAR;AACH;AACJ;AAEJ,yBAZD;AAaAhB,gCAAQgB,EAAR;AACH,qBAjBL,EAiBO,UAACiB,GAAD,EAAS;AACRhC,+BAAOgC,GAAP;AACH,qBAnBL;AAoBH,iBArBM,CAAP;AAsBH,aAnES;AAoEVG,0BApEU,0BAoEKlE,KApEL,EAoEYmE,EApEZ,EAoEgBC,KApEhB,EAoEuBnE,IApEvB,EAoE6B;AACnC,uBAAO,IAAI4B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCoC,uBAAGrE,GAAH,CAAOuE,OAAP,CAAe,EAAEpC,OAAO,EAAEa,IAAIsB,KAAN,EAAanE,MAAMA,IAAnB,EAAyBsB,WAAW,EAAE+C,KAAK,IAAP,EAApC,EAAT,EAAf,EACKpC,IADL,CACU,UAACC,IAAD,EAAU;AACZnC,8BAAMuE,UAAN,CAAiB,EAAEC,aAAaJ,KAAf,EAAjB,EAAyC,EAAEK,MAAM,EAAE,eAAe,EAAjB,EAAR,EAAzC,EAA0EvC,IAA1E,CAA+E,UAACgB,IAAD,EAAU;AACrFpB,oCAAQ,SAAR;AACH,yBAFD,EAEG4C,KAFH,CAES;AAAA,mCAAO3C,OAAOgC,GAAP,CAAP;AAAA,yBAFT;AAGH,qBALL,EAKOW,KALP,CAKa;AAAA,+BAAO3C,OAAOgC,GAAP,CAAP;AAAA,qBALb;AAMH,iBAPM,CAAP;AAQH,aA7ES;AA8EVY,uBA9EU,uBA8EEP,KA9EF,EA8ES;AAAA;;AACf,uBAAO,IAAIvC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,2BAAK6C,QAAL,CAAcR,KAAd,EACKlC,IADL,CACU,UAAC2C,QAAD,EAAc;AAAE/C,gCAAQ+C,QAAR;AAAmB,qBAD7C,EAEKH,KAFL,CAEW,UAACI,KAAD,EAAW;AAAE/C,+BAAO,EAAE+C,OAAO,CAAT,EAAYC,SAASD,KAArB,EAA4B5B,MAAM,EAAlC,EAAP;AAAgD,qBAFxE;AAGH,iBAJM,CAAP;AAKH,aApFS;AAqFV8B,iCArFU,iCAqFYzC,GArFZ,EAqFiB0C,GArFjB,EAqFsB;AAC5B,uBAAO,IAAIpD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCkD,wBAAIjF,KAAJ,CAAU6C,IAAV,CAAe,EAAEL,QAAQ,EAAE8B,KAAK/B,IAAI0B,QAAJ,EAAP,EAAV,EAAf,EAAoD/B,IAApD,CAAyD,UAACgB,IAAD,EAAU;AAC/D,4BAAIJ,KAAK,EAAT;AACA,4BAAII,KAAKgC,MAAT,EAAiB;AACb,6CAAE/B,GAAF,CAAMD,IAAN,EAAY,UAACE,GAAD,EAAMC,GAAN,EAAc;AACtB,oCAAKD,IAAI/C,OAAJ,CAAYiD,KAAZ,CAAkB,IAAIC,MAAJ,CAAW0B,IAAIE,IAAJ,CAAS9E,OAApB,EAA6B,IAA7B,CAAlB,CAAD,IAA6D4E,IAAIE,IAAJ,CAASvE,EAAT,IAAeqE,IAAIE,IAAJ,CAASrE,IAAzB,IAAmC,IAAI0C,IAAJ,CAASJ,IAAIK,IAAb,EAAmBC,OAAnB,KAA+B,IAAIF,IAAJ,CAASyB,IAAIE,IAAJ,CAASvE,EAAlB,EAAsB8C,OAAtB,EAA/B,IAAkE,IAAIF,IAAJ,CAASJ,IAAIK,IAAb,EAAmBC,OAAnB,KAA+B,IAAIF,IAAJ,CAASyB,IAAIE,IAAJ,CAASrE,IAAlB,EAAwB4C,OAAxB,EAAhM,IAAyOuB,IAAIE,IAAJ,CAASnF,KAAV,IAAqBoD,IAAIO,WAAJ,CAAgBL,KAAhB,CAAsB,IAAIC,MAAJ,CAAW0B,IAAIE,IAAJ,CAASnF,KAApB,EAA2B,IAA3B,CAAtB,CAAjQ,EAA4T;AACxT8C,uCAAGc,IAAH,CAAQR,IAAIS,GAAZ;AACA,wCAAIR,OAAQ,iBAAES,IAAF,CAAOZ,IAAP,IAAe,CAA3B,EAA+B;AAC3BD,kDAAUH,EAAV;AACH;AACJ,iCALD,MAKO;AACH,wCAAIO,OAAQ,iBAAES,IAAF,CAAOZ,IAAP,IAAe,CAA3B,EAA+B;AAC3BD,kDAAUH,EAAV;AACH;AACJ;AAEJ,6BAZD;AAaH,yBAdD,MAcO;AACHhB;AACH;;AAED,iCAASmB,SAAT,CAAmBH,EAAnB,EAAuB;AACnB,gCAAIsC,UAAUtC,GAAGuC,MAAH,CAAU,CAAV,EAAa,GAAb,CAAd;AACAJ,gCAAIjF,KAAJ,CAAUsF,MAAV,CAAiB,EAAEzB,KAAK,EAAE0B,KAAKH,OAAP,EAAP,EAAjB,EAA4C,EAAE,QAAQ,EAAE,UAAU,CAAC7C,IAAI0B,QAAJ,EAAD,CAAZ,EAAV,EAA0C,mBAAmB,IAAIT,IAAJ,GAAWE,OAAX,EAA7D,EAAmF8B,WAAW,IAAIhC,IAAJ,EAA9F,EAA0GiC,QAAQ,KAAlH,EAA5C,EAAuK,EAAEC,OAAO,IAAT,EAAvK,EACKxD,IADL,CACU,UAACyD,KAAD,EAAW;AACb,oCAAI,CAAC7C,GAAGoC,MAAR,EAAgB;AACZpD,4CAAQ,EAAEiD,SAAS,0BAAX,EAAR;AACH,iCAFD,MAEO;AACH9B,8CAAUH,EAAV;AACH;AACJ,6BAPL;AAQH;AACJ,qBA/BD;AAgCH,iBAjCM,CAAP;AAkCH,aAxHS;AAyHV8C,0BAzHU,0BAyHKT,IAzHL,EAyHW;AACjB,uBAAO,IAAItD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC8D,oCAAgBV,IAAhB,EAAsB,UAASN,QAAT,EAAmB;AACrC/C,gCAAQ+C,QAAR;AACH,qBAFD;AAGH,iBAJM,CAAP;;AAMA,yBAASgB,eAAT,CAAyBV,IAAzB,EAA+BW,QAA/B,EAAyC;AACrC,wBAAI5C,OAAOiC,KAAKE,MAAL,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAAX;AACAvF,wBAAIwF,MAAJ,CAAW,EAAEhE,UAAU4B,KAAK5B,QAAjB,EAAX,EAAwC,EAAEW,OAAO,EAAEa,IAAII,KAAKJ,EAAX,EAAT,EAAxC,EAAoEZ,IAApE,CAAyE,UAAC6D,eAAD,EAAqB;AAC1F,4BAAIZ,KAAKD,MAAT,EAAiB;AACbW,4CAAgBV,IAAhB,EAAsBW,QAAtB;AACH,yBAFD,MAEO;AACHA,qCAAS,qBAAT;AACH;AACJ,qBAND;AAOH;AACJ,aA1IS;AA2IVE,8BA3IU,8BA2IS3F,OA3IT,EA2IkB;AAAA;;AACxB,uBAAO,IAAIwB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,wBAAIqC,QAAQ,EAAZ;AACA,2BAAK6B,OAAL,CAAa,EAAEhG,MAAM,0BAAWiG,OAAX,CAAmBC,SAA3B,EAAsC1F,oBAAoB,CAA1D,EAAb,EAA4EyB,IAA5E,CAAiF,UAAC2C,QAAD,EAAc;AAC3F,yCAAEuB,OAAF,CAAUvB,QAAV,EAAoB,UAACzB,GAAD,EAAMC,GAAN,EAAc;AAC9B,gCAAID,IAAI5B,OAAR,EAAiB;AACb,oCAAI6E,WAAWjD,IAAI5B,OAAJ,CAAY8E,KAAZ,CAAkB,GAAlB,CAAf;AACA,iDAAEF,OAAF,CAAUC,QAAV,EAAoB,UAACE,WAAD,EAAcC,WAAd,EAA8B;;AAE9C,wCAAI,CAACnG,WAAWoG,SAAX,GAAuBpG,QAAQiD,KAAR,CAAc,IAAIC,MAAJ,CAAWgD,WAAX,EAAwB,IAAxB,CAAd,CAAvB,GAAsE,KAAvE,KAAiF,IAArF,EAA2F;AACvFnC,8CAAMR,IAAN,CAAWR,IAAIN,EAAJ,CAAOmB,QAAP,EAAX;AACH;AACJ,iCALD;AAMH;AACD,gCAAIZ,OAAOwB,SAASK,MAAT,GAAkB,CAA7B,EAAgC;AAC5BpD,wCAAQsC,MAAMsC,MAAN,CAAa,UAACC,CAAD,EAAIC,CAAJ,EAAOC,CAAP;AAAA,2CAAaA,EAAEC,OAAF,CAAUH,CAAV,MAAiBC,CAA9B;AAAA,iCAAb,CAAR;AACH;AACJ,yBAbD;AAcH,qBAfD;AAgBH,iBAlBM,CAAP;AAmBH,aA/JS;AAgKVG,+BAhKU,+BAgKU9B,GAhKV,EAgKe;AACrB,uBAAO,IAAIpD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,wBAAIkD,IAAIE,IAAJ,CAASM,MAAb,EAAqB;AACjBR,4BAAIjF,KAAJ,CAAUsF,MAAV,CAAiB,EAAE9C,QAAQyC,IAAIE,IAAJ,CAAS3C,MAAnB,EAA2BiB,MAAM,EAAE,QAAQ,IAAID,IAAJ,CAASyB,IAAIE,IAAJ,CAAS6B,KAAlB,CAAV,EAAoC,OAAO,IAAIxD,IAAJ,CAASyB,IAAIE,IAAJ,CAAS8B,GAAlB,CAA3C,EAAjC,EAAjB,EAAyH,EAAEzE,QAAQ,EAAV,EAAcgC,aAAa,EAA3B,EAA+BiB,QAAQ,KAAvC,EAA8CD,WAAW,IAAIhC,IAAJ,EAAzD,EAAzH,EAAgM,EAAEkC,OAAO,IAAT,EAAhM,EAAiNxD,IAAjN,CAAsN,UAAC2C,QAAD,EAAc;AAChO/C,oCAAQ,EAAEkB,QAAQ,CAAV,EAAa+B,SAAS,oBAAtB,EAAR;AACH,yBAFD;AAGH,qBAJD,MAIO;AACHE,4BAAIjF,KAAJ,CAAUsF,MAAV,CAAiB,EAAE9C,QAAQyC,IAAIE,IAAJ,CAAS3C,MAAnB,EAA2BiB,MAAM,EAAE,QAAQ,IAAID,IAAJ,CAASyB,IAAIE,IAAJ,CAAS6B,KAAlB,CAAV,EAAoC,OAAO,IAAIxD,IAAJ,CAASyB,IAAIE,IAAJ,CAAS8B,GAAlB,CAA3C,EAAjC,EAAjB,EAAyH,EAAEzE,QAAQ,EAAV,EAAcgC,aAAa,EAA3B,EAA+BgB,WAAW,IAAIhC,IAAJ,EAA1C,EAAzH,EAAiL,EAAEkC,OAAO,IAAT,EAAjL,EAAkMxD,IAAlM,CAAuM,UAAC2C,QAAD,EAAc;AACjN/C,oCAAQ,EAAEkB,QAAQ,CAAV,EAAa+B,SAAS,oBAAtB,EAAR;AACH,yBAFD;AAGH;AAEJ,iBAXM,CAAP;AAYH;AA7KS,SAtBf;AAqMCmC,mBAAW,mBAACC,MAAD,EAAY;AACnBrH,gBAAIsH,SAAJ,CAAcD,OAAOE,QAArB,EAA+B,EAAEC,YAAY,aAAd,EAA6BjG,WAAW,IAAxC,EAA/B;AACH;AAvMF,KAvDS,CAAZ;AAgQA,WAAOvB,GAAP;AACH,C;;AArQD;;;;AACA","file":"tag.js","sourcesContent":["import _ from 'lodash';\nimport constant from './constant.js';\n\nexport default function(sequelize, DataTypes) {\n    const Tag = sequelize.define(\"TAG\", {\n        email: {\n            type: DataTypes.STRING,\n        },\n        title: {\n            type: DataTypes.STRING,\n        },\n        color: DataTypes.STRING,\n        subject: {\n            type: DataTypes.STRING(255),\n            unique: false,\n        },\n        type: {\n            type: DataTypes.ENUM,\n            values: [\"Default\", \"Manual\", \"Automatic\"],\n        },\n        is_job_profile_tag: {\n            type: DataTypes.BOOLEAN,\n            defaultValue: 0\n        },\n        to: DataTypes.DATE,\n        from: DataTypes.DATE,\n        assign_to_all_emails: {\n            type: DataTypes.BOOLEAN,\n            defaultValue: 0\n        },\n        template_id: { type: DataTypes.INTEGER },\n        default_id: {\n            type: DataTypes.INTEGER,\n            defaultValue: 0\n        },\n        is_email_send: {\n            type: DataTypes.BOOLEAN,\n            defaultValue: 0\n        },\n        job_description: {\n            type: DataTypes.STRING,\n            defaultValue: \"\",\n            allowNull: true\n        },\n        priority: {\n            type: DataTypes.STRING,\n            defaultValue: 0,\n            allowNull: true\n        },\n        parent_id: {\n            type: DataTypes.INTEGER,\n            defaultValue: 0,\n            allowNull: true\n        },\n        keyword: {\n            type: DataTypes.STRING,\n            defaultValue: null,\n            allowNull: true\n        }\n    }, {\n        hooks: {\n            beforeCreate: function(TAG, options) {\n                return new Promise((resolve, reject) => {\n                    if (!TAG.parent_id) {\n                        this.findOne({ where: { subject: TAG.subject } })\n                            .then((docs) => {\n                                if (docs) {\n                                    reject(\"Subject Already Exists\");\n                                } else {\n                                    resolve({ docs })\n                                }\n                            })\n                    } else {\n                        resolve()\n                    }\n                })\n            }\n        },\n        timestamps: true,\n        freezeTableName: true,\n        allowNull: true,\n        classMethods: {\n            // login.....\n            tag(tag_id) {\n                app.route(\"/tag/add/:type\").post(tag.save);\n                return new Promise((resolve, reject) => {\n                    this.find({\n                            where: {\n                                id: tag_id\n                            }\n                        })\n                        .then((details) => {\n                            if (details) {\n                                resolve({\n                                    status: 1\n                                });\n                            } else {\n                                reject(\"Invalid tag_id\");\n                            }\n                        });\n                });\n            },\n            assignTag(tag, email) {\n                return new Promise((resolve, reject) => {\n                    email.find({})\n                        .then((data) => {\n                            var id = []\n                            _.map(data, (val, key) => {\n                                if ((val.subject.match(new RegExp(tag.subject, 'gi'))) || ((tag.to && tag.from) && (new Date(val.date).getTime() < new Date(tag.to).getTime() && new Date(val.date).getTime() > new Date(tag.from).getTime())) || ((tag.email) && (val.sender_mail.match(new RegExp(tag.email, 'gi'))))) {\n                                    id.push(val._id);\n                                    if (key == (_.size(data) - 1)) {\n                                        resolve(id)\n                                    }\n                                } else {\n                                    if (key == (_.size(data) - 1)) {\n                                        resolve(id)\n                                    }\n                                }\n\n                            })\n                        }, (err) => {\n                            reject(err)\n                        })\n                })\n            },\n            assignNewTag(tag, email) {\n                return new Promise((resolve, reject) => {\n                    email.find({ tag_id: (tag.parent_id).toString() })\n                        .then((data) => {\n                            var id = []\n                            _.map(data, (val, key) => {\n                                if ((tag.subject && val.subject.match(new RegExp(tag.subject, 'gi'))) || ((tag.to && tag.from) && (new Date(val.date).getTime() < new Date(tag.to).getTime() && new Date(val.date).getTime() > new Date(tag.from).getTime())) || ((tag.email) && (val.sender_mail.match(new RegExp(tag.email, 'gi'))))) {\n                                    id.push(val._id);\n                                    if (key == (_.size(data) - 1)) {\n                                        resolve(id)\n                                    }\n                                } else {\n                                    if (key == (_.size(data) - 1)) {\n                                        resolve(id)\n                                    }\n                                }\n\n                            })\n                            resolve(id)\n                        }, (err) => {\n                            reject(err)\n                        })\n                })\n            },\n            destroyDefault(email, db, tagId, type) {\n                return new Promise((resolve, reject) => {\n                    db.Tag.destroy({ where: { id: tagId, type: type, parent_id: { $ne: null } } })\n                        .then((docs) => {\n                            email.updateMany({ default_tag: tagId }, { $set: { \"default_tag\": \"\" } }).then((data) => {\n                                resolve(\"SUCCESS\")\n                            }).catch(err => reject(err))\n                        }).catch(err => reject(err))\n                })\n            },\n            findTagInfo(tagId) {\n                return new Promise((resolve, reject) => {\n                    this.findById(tagId)\n                        .then((response) => { resolve(response) })\n                        .catch((error) => { reject({ error: 1, message: error, data: [] }) })\n                })\n            },\n            assignTagDuringUpdate(tag, req) {\n                return new Promise((resolve, reject) => {\n                    req.email.find({ tag_id: { $ne: tag.toString() } }).then((data) => {\n                        let id = []\n                        if (data.length) {\n                            _.map(data, (val, key) => {\n                                if ((val.subject.match(new RegExp(req.body.subject, 'gi'))) || ((req.body.to && req.body.from) && (new Date(val.date).getTime() < new Date(req.body.to).getTime() && new Date(val.date).getTime() > new Date(req.body.from).getTime())) || ((req.body.email) && (val.sender_mail.match(new RegExp(req.body.email, 'gi'))))) {\n                                    id.push(val._id);\n                                    if (key == (_.size(data) - 1)) {\n                                        assignTag(id)\n                                    }\n                                } else {\n                                    if (key == (_.size(data) - 1)) {\n                                        assignTag(id)\n                                    }\n                                }\n\n                            })\n                        } else {\n                            resolve();\n                        }\n\n                        function assignTag(id) {\n                            let mongoId = id.splice(0, 100)\n                            req.email.update({ _id: { $in: mongoId } }, { \"$set\": { \"tag_id\": [tag.toString()] }, \"email_timestamp\": new Date().getTime(), updatedAt: new Date(), unread: false }, { multi: true })\n                                .then((data1) => {\n                                    if (!id.length) {\n                                        resolve({ message: \"tag assigned sucessfully\" })\n                                    } else {\n                                        assignTag(id)\n                                    }\n                                })\n                        }\n                    })\n                });\n            },\n            updatePriority(body) {\n                return new Promise((resolve, reject) => {\n                    update_priority(body, function(response) {\n                        resolve(response)\n                    })\n                });\n\n                function update_priority(body, callback) {\n                    let data = body.splice(0, 1)[0];\n                    Tag.update({ priority: data.priority }, { where: { id: data.id } }).then((update_response) => {\n                        if (body.length) {\n                            update_priority(body, callback)\n                        } else {\n                            callback(\"new priority is set\")\n                        }\n                    })\n                }\n            },\n            assignTagByKeyword(subject) {\n                return new Promise((resolve, reject) => {\n                    let tagId = []\n                    this.findAll({ type: constant().tagType.automatic, is_job_profile_tag: 1 }).then((response) => {\n                        _.forEach(response, (val, key) => {\n                            if (val.keyword) {\n                                let keywords = val.keyword.split(\",\");\n                                _.forEach(keywords, (keyword_val, keyword_key) => {\n\n                                    if ((subject != undefined ? subject.match(new RegExp(keyword_val, 'gi')) : false) != null) {\n                                        tagId.push(val.id.toString())\n                                    }\n                                })\n                            }\n                            if (key == response.length - 1) {\n                                resolve(tagId.filter((v, i, a) => a.indexOf(v) === i))\n                            }\n                        })\n                    })\n                });\n            },\n            removeTagFromEmails(req) {\n                return new Promise((resolve, reject) => {\n                    if (req.body.unread) {\n                        req.email.update({ tag_id: req.body.tag_id, date: { \"$gte\": new Date(req.body.start), \"$lt\": new Date(req.body.end) } }, { tag_id: [], default_tag: \"\", unread: false, updatedAt: new Date() }, { multi: true }).then((response) => {\n                            resolve({ status: 1, message: \"moved to all mails\" })\n                        })\n                    } else {\n                        req.email.update({ tag_id: req.body.tag_id, date: { \"$gte\": new Date(req.body.start), \"$lt\": new Date(req.body.end) } }, { tag_id: [], default_tag: \"\", updatedAt: new Date() }, { multi: true }).then((response) => {\n                            resolve({ status: 1, message: \"moved to all mails\" })\n                        })\n                    }\n\n                });\n            }\n        },\n        associate: (models) => {\n            Tag.belongsTo(models.Template, { foreignKey: 'template_id', allowNull: true })\n        }\n    });\n    return Tag;\n}"]}